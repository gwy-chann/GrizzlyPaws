<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grizzly Paws Products</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../style.css">
    <style>
        .content {
            padding: 30px;
            max-width: 2000px;
            margin: 0 auto;
            max-height: calc(100vh - 80px);
            overflow-y: auto;
        }

        /* Photo upload styles */
        .photo-upload-container {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .photo-upload-box {
            width: 120px;
            height: 120px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            background: #f9f9f9;
        }

        .photo-upload-box:hover {
            border-color: #83a75d;
            background: #fff;
        }

        .photo-upload-box input[type="file"] {
            display: none;
        }

        .photo-upload-box .upload-icon {
            font-size: 32px;
            color: #999;
            margin-bottom: 5px;
        }

        .photo-upload-box .upload-text {
            font-size: 12px;
            color: #666;
            text-align: center;
        }

        .photo-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }

        .photo-upload-box.has-image .photo-preview {
            display: block;
        }

        .photo-upload-box.has-image .upload-icon,
        .photo-upload-box.has-image .upload-text {
            display: none;
        }

        .remove-photo-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            z-index: 10;
        }

        .photo-upload-box.has-image .remove-photo-btn {
            display: flex;
        }

        .remove-photo-btn:hover {
            background: rgba(255, 0, 0, 1);
        }

        /* Product photos in table */
        .product-photos {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .product-photo-thumb {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .product-photo-thumb:hover {
            transform: scale(1.1);
            border-color: #8B4513;
        }

        .no-photos-text {
            color: #999;
            font-size: 12px;
            font-style: italic;
        }

        /* Photo viewer modal */
        .photo-viewer-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
        }

        .photo-viewer-content {
            position: relative;
            margin: auto;
            padding: 0;
            width: 90%;
            max-width: 900px;
            top: 50%;
            transform: translateY(-50%);
        }

        .photo-viewer-image {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 8px;
        }

        .photo-viewer-close {
            position: absolute;
            top: -40px;
            right: 0;
            color: #fff;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
        }

        .photo-viewer-close:hover {
            color: #ccc;
        }

        /* Edit photos modal specific styles */
        #editPhotosModal .modal-body {
            min-height: 200px;
        }

        .current-photos-label {
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <div class="header">
        <div class="logo-container">
            <a href="javascript:void(0)" title="Return to Homepage" aria-label="Go to Homepage">
                <img src="images/logo3.png" alt="Grizzly Paws Logo" class="logo" />
            </a>
        </div>

        <div class="account-dropdown">
            <a href="admin.html" class="account-button" href="javascript:void(0)" aria-label="My account">
                <i class="fas fa-user-circle" aria-hidden="true"></i>
            </a>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Main Container with Sidebar and Content -->
    <div class="main-container">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <div class="sidebar-menu">
                <div class="menu-item">
                    <a href="index.html" style="display: flex; align-items: center; gap: 15px; text-decoration: none; color: inherit; width: 100%;">
                        <span class="menu-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                            </svg>
                        </span>
                        Homepage
                    </a>
                </div>
                <div class="menu-item">
                    <a href="dashboard.html" style="display: flex; align-items: center; gap: 15px; text-decoration: none; color: inherit; width: 100%;">
                        <span class="menu-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7"></rect>
                                <rect x="14" y="3" width="7" height="7"></rect>
                                <rect x="14" y="14" width="7" height="7"></rect>
                                <rect x="3" y="14" width="7" height="7"></rect>
                            </svg>
                        </span>
                        Dashboard
                    </a>
                </div>
                <div class="menu-item active">
                    <a href="products.html" style="display: flex; align-items: center; gap: 15px; text-decoration: none; color: inherit; width: 100%;">
                        <span class="menu-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                                <line x1="3" y1="6" x2="21" y2="6"></line>
                                <path d="M16 10a4 4 0 0 1-8 0"></path>
                            </svg>
                        </span>
                        Products
                    </a>
                </div>
                <div class="menu-item">
                    <a href="manage_order.html" style="display: flex; align-items: center; gap: 15px; text-decoration: none; color: inherit; width: 100%;">
                        <span class="menu-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                <line x1="12" y1="22.08" x2="12" y2="12"></line>
                            </svg>
                        </span>
                        Manage Order
                    </a>
                </div>
                <div class="menu-item">
                    <a href="manage_reviews.html" style="display: flex; align-items: center; gap: 15px; text-decoration: none; color: inherit; width: 100%;">
                        <span class="menu-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                            </svg>
                        </span>
                        Manage Reviews
                    </a>
                </div>
                <div class="menu-item">
                    <a href="concern.html" style="display: flex; align-items: center; gap: 15px; text-decoration: none; color: inherit; width: 100%;">
                        <span class="menu-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                <circle cx="12" cy="8" r="1"></circle>
                                <path d="M12 10v4"></path>
                            </svg>
                        </span>
                        Concern
                    </a>
                </div>
                <div class="menu-item">
                    <a href="user-management.html" style="display: flex; align-items: center; gap: 15px; text-decoration: none; color: inherit; width: 100%;">
                        <span class="menu-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                            </svg>
                        </span>
                        User Management
                    </a>
                </div>
            </div>
           <div class="logout">
                <a href="login.html" style="display: flex; align-items: center; gap: 15px; text-decoration: none; color: inherit; width: 100%;">
                    Log out
                </a>
    
            </div>
        </div>
    
        <!-- Main Content Area -->
        <div class="content">
            <h1 class="dashboard-title">Products</h1>


            <div class="controls">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Search by product name, category, or sub-category..." />
                    <i class="fas fa-search"></i>
                </div>

                <div class="filter-section">
                    <select id="subcategory-filter" class="subcategory-dropdown">
                    </select>
                    
                    <select id="category-filter" class="category-dropdown">
                        <option value="all">All Products</option>
                        <option value="dog">Dog</option>
                        <option value="cat">Cat</option>
                        <option value="small-pet">Small Pet</option>
                        <option value="feathered">Feathered</option>
                        <option value="aquatic">Aquatic</option>
                    </select>
                </div>

            </div>

            

            <!-- Products Table -->
            <div class="products-table-container">
                <table class="products-table">
                    <thead>
                        <tr>
                            <th>ProductID</th>
                            <th>Product Name</th>
                            <th>Category</th>
                            <th>Sub Category</th>
                            <th>Photos</th>
                            <th>Stocks</th>
                            <th>Price</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="products-table-body">
                        <tr data-category="dog" data-subcategory="Dog Treats">
                            <td><strong>0123</strong></td>
                            <td>Pedigree Dental Stix</td>
                            <td>Dog</td>
                            <td>Dog Treats</td>
                            <td>
                                <div class="product-photos">
                                    <span class="no-photos-text">No photos</span>
                                </div>
                            </td>
                            <td>20</td>
                            <td>₱60.00</td>
                            <td>
                                <div class="action-dropdown">
                                    <button class="action-btn">
                                        <i class="fas fa-ellipsis-h"></i>
                                    </button>
                                    <div class="action-menu">
                                        <div class="action-item" data-action="edit-name">Edit Product Name</div>
                                        <div class="action-item" data-action="edit-category">Edit Category</div>
                                        <div class="action-item" data-action="edit-subcategory">Edit Sub-Category</div>
                                        <div class="action-item" data-action="edit-photos">Edit Photos</div>
                                        <div class="action-item" data-action="manage-stocks">Manage Stocks</div>
                                        <div class="action-item" data-action="edit-price">Edit Product Price</div>
                                        <div class="action-item delete" data-action="delete">Delete</div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr data-category="cat" data-subcategory="Wet Cat Food">
                            <td><strong>0124</strong></td>
                            <td>Royal Canin Light Weight Care Wet Food</td>
                            <td>Cat</td>
                            <td>Wet Cat Food</td>
                            <td>
                                <div class="product-photos">
                                    <span class="no-photos-text">No photos</span>
                                </div>
                            </td>
                            <td>100</td>
                            <td>₱999.00</td>
                            <td>
                                <div class="action-dropdown">
                                    <button class="action-btn">
                                        <i class="fas fa-ellipsis-h"></i>
                                    </button>
                                    <div class="action-menu">
                                        <div class="action-item" data-action="edit-name">Edit Product Name</div>
                                        <div class="action-item" data-action="edit-category">Edit Category</div>
                                        <div class="action-item" data-action="edit-subcategory">Edit Sub-Category</div>
                                        <div class="action-item" data-action="edit-photos">Edit Photos</div>
                                        <div class="action-item" data-action="manage-stocks">Manage Stocks</div>
                                        <div class="action-item" data-action="edit-price">Edit Product Price</div>
                                        <div class="action-item delete" data-action="delete">Delete</div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="pagination">
                    <div class="pagination-content">
                        <div class="page-numbers">
                            <button class="page-btn prev-btn">&lt;</button>
                            <button class="page-number active">1</button>
                            <button class="page-btn next-btn">&gt;</button>
                        </div>
                        <button class="add-product-btn" id="addProductBtn">
                            <i class="fas fa-plus"></i>
                            Add Product
                        </button>
                    </div>
                </div>
            </div>

            <div class="footer">
                Copyright © 2025 GrizzlyPaws. All rights reserved
            </div>
        </div>
    </div>

    <!-- MODALS -->

    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Product</h3>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label for="newProductId">Product ID:</label>
                        <input type="text" id="newProductId" class="form-input" placeholder="Enter product ID">
                    </div>
                    <div class="form-group">
                        <label for="newProductName">Product Name:</label>
                        <input type="text" id="newProductName" class="form-input" placeholder="Enter product name">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="newProductCategory">Category:</label>
                        <select id="newProductCategory" class="form-select">
                            <option value="">Select Category</option>
                            <option value="dog">Dog</option>
                            <option value="cat">Cat</option>
                            <option value="small-pet">Small Pet</option>
                            <option value="feathered">Feathered</option>
                            <option value="aquatic">Aquatic</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="newProductSubCategory">Sub-Category:</label>
                        <select id="newProductSubCategory" class="form-select">
                            <option value="">Select Sub-Category</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Product Photos (up to 3):</label>
                    <div class="photo-upload-container" id="addProductPhotos">
                        <div class="photo-upload-box" data-index="0">
                            <input type="file" accept="image/*">
                            <i class="fas fa-camera upload-icon"></i>
                            <span class="upload-text">Add Photo</span>
                            <img class="photo-preview" alt="Preview">
                            <button type="button" class="remove-photo-btn"><i class="fas fa-times"></i></button>
                        </div>
                        <div class="photo-upload-box" data-index="1">
                            <input type="file" accept="image/*">
                            <i class="fas fa-camera upload-icon"></i>
                            <span class="upload-text">Add Photo</span>
                            <img class="photo-preview" alt="Preview">
                            <button type="button" class="remove-photo-btn"><i class="fas fa-times"></i></button>
                        </div>
                        <div class="photo-upload-box" data-index="2">
                            <input type="file" accept="image/*">
                            <i class="fas fa-camera upload-icon"></i>
                            <span class="upload-text">Add Photo</span>
                            <img class="photo-preview" alt="Preview">
                            <button type="button" class="remove-photo-btn"><i class="fas fa-times"></i></button>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="newProductStocks">Stocks:</label>
                        <input type="number" id="newProductStocks" class="form-input" placeholder="Enter stock quantity" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="newProductPrice">Price (₱):</label>
                        <input type="number" id="newProductPrice" class="form-input" placeholder="Enter price" min="0" step="0.01">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel">Cancel</button>
                <button type="button" class="btn-add">Add Product</button>
            </div>
        </div>
    </div>

    <!-- Edit Photos Modal -->
    <div id="editPhotosModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Product Photos</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="current-photos-label">Product Photos (up to 3):</label>
                    <div class="photo-upload-container" id="editProductPhotos">
                        <div class="photo-upload-box" data-index="0">
                            <input type="file" accept="image/*">
                            <i class="fas fa-camera upload-icon"></i>
                            <span class="upload-text">Add Photo</span>
                            <img class="photo-preview" alt="Preview">
                            <button type="button" class="remove-photo-btn"><i class="fas fa-times"></i></button>
                        </div>
                        <div class="photo-upload-box" data-index="1">
                            <input type="file" accept="image/*">
                            <i class="fas fa-camera upload-icon"></i>
                            <span class="upload-text">Add Photo</span>
                            <img class="photo-preview" alt="Preview">
                            <button type="button" class="remove-photo-btn"><i class="fas fa-times"></i></button>
                        </div>
                        <div class="photo-upload-box" data-index="2">
                            <input type="file" accept="image/*">
                            <i class="fas fa-camera upload-icon"></i>
                            <span class="upload-text">Add Photo</span>
                            <img class="photo-preview" alt="Preview">
                            <button type="button" class="remove-photo-btn"><i class="fas fa-times"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel">Cancel</button>
                <button type="button" class="btn-update">Update</button>
            </div>
        </div>
    </div>

    <!-- Other Modals (keeping all existing modals) -->
    <div id="editProductNameModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Product Name</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="productName">Update Product Name:</label>
                    <input type="text" id="productName" class="form-input" placeholder="Enter new product name">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel">Cancel</button>
                <button type="button" class="btn-update">Update</button>
            </div>
        </div>
    </div>

    <div id="editCategoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Category</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="productCategory">Update Category:</label>
                    <select id="productCategory" class="form-select">
                        <option value="dog">Dog</option>
                        <option value="cat">Cat</option>
                        <option value="small-pet">Small Pet</option>
                        <option value="feathered">Feathered</option>
                        <option value="aquatic">Aquatic</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel">Cancel</button>
                <button type="button" class="btn-update">Update</button>
            </div>
        </div>
    </div>

    <div id="editSubCategoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Sub-Category</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="productSubCategory">Update Sub-Category:</label>
                    <select id="productSubCategory" class="form-select">
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel">Cancel</button>
                <button type="button" class="btn-update">Update</button>
            </div>
        </div>
    </div>

    <div id="manageStocksModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Manage Stocks</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="productStocks">Update Stocks:</label>
                    <input type="number" id="productStocks" class="form-input" placeholder="Enter new stock quantity" min="0">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel">Cancel</button>
                <button type="button" class="btn-update">Update</button>
            </div>
        </div>
    </div>

    <div id="editProductPriceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Product Price</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="productPrice">Update Price (₱):</label>
                    <input type="number" id="productPrice" class="form-input" placeholder="Enter new price" min="0" step="0.01">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel">Cancel</button>
                <button type="button" class="btn-update">Update</button>
            </div>
        </div>
    </div>

    <div id="deleteConfirmationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Delete Product</h3>
            </div>
            <div class="modal-body">
                <div class="delete-confirmation">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h4>Are you sure?</h4>
                    <p>This action cannot be undone. This will permanently delete the product <strong id="deleteProductName"></strong>.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel">Cancel</button>
                <button type="button" class="btn-delete">Delete</button>
            </div>
        </div>
    </div>

    <!-- Photo Viewer Modal -->
    <div id="photoViewerModal" class="photo-viewer-modal">
        <div class="photo-viewer-content">
            <button class="photo-viewer-close">&times;</button>
            <img class="photo-viewer-image" id="photoViewerImage" alt="Product Photo">
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const categoryFilter = document.getElementById('category-filter');
            const subcategoryFilter = document.getElementById('subcategory-filter');
            const productsTableBody = document.getElementById('products-table-body');
            const addProductModal = document.getElementById('addProductModal');
            const editProductNameModal = document.getElementById('editProductNameModal');
            const editCategoryModal = document.getElementById('editCategoryModal');
            const editSubCategoryModal = document.getElementById('editSubCategoryModal');
            const editPhotosModal = document.getElementById('editPhotosModal');
            const manageStocksModal = document.getElementById('manageStocksModal');
            const editProductPriceModal = document.getElementById('editProductPriceModal');
            const deleteConfirmationModal = document.getElementById('deleteConfirmationModal');
            const photoViewerModal = document.getElementById('photoViewerModal');
            
            const addProductBtn = document.getElementById('addProductBtn');
            
            const newProductIdInput = document.getElementById('newProductId');
            const newProductNameInput = document.getElementById('newProductName');
            const newProductCategoryInput = document.getElementById('newProductCategory');
            const newProductSubCategoryInput = document.getElementById('newProductSubCategory');
            const newProductStocksInput = document.getElementById('newProductStocks');
            const newProductPriceInput = document.getElementById('newProductPrice');
            
            const productNameInput = document.getElementById('productName');
            const productCategoryInput = document.getElementById('productCategory');
            const productSubCategoryInput = document.getElementById('productSubCategory');
            const productStocksInput = document.getElementById('productStocks');
            const productPriceInput = document.getElementById('productPrice');
            const deleteProductNameSpan = document.getElementById('deleteProductName');
            
            const cancelBtns = document.querySelectorAll('.btn-cancel');
            const updateBtns = document.querySelectorAll('.btn-update');
            const deleteBtn = document.querySelector('.btn-delete');
            const addProductSubmitBtn = document.querySelector('.btn-add');
            const notificationContainer = document.getElementById('notificationContainer');
            
            const photoViewerImage = document.getElementById('photoViewerImage');
            const photoViewerClose = document.querySelector('.photo-viewer-close');
            
            let currentDeleteRowIndex = null;
            let productIdCounter = 124;
            let currentEditPhotoRowIndex = null;

            // Notification System
            function showNotification(type, title, message, duration = 4000) {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                
                const icons = {
                    success: 'fas fa-check-circle',
                    error: 'fas fa-exclamation-circle',
                    warning: 'fas fa-exclamation-triangle'
                };
                
                notification.innerHTML = `
                    <div class="notification-icon">
                        <i class="${icons[type]}"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">${title}</div>
                        <div class="notification-message">${message}</div>
                    </div>
                     <button class="notification-close">
                      <i class="fas fa-times"></i>
                     </button>
                `;
                
                notificationContainer.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.add('show');
                }, 10);
                
                const closeBtn = notification.querySelector('.notification-close');
                closeBtn.addEventListener('click', () => {
                    hideNotification(notification);
                });
                
                if (duration > 0) {
                    setTimeout(() => {
                        hideNotification(notification);
                    }, duration);
                }
            }
            
            function hideNotification(notification) {
                notification.classList.remove('show');
                notification.classList.add('hide');
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }
            
            // Photo Upload Handler
            function setupPhotoUpload(container) {
                const uploadBoxes = container.querySelectorAll('.photo-upload-box');
                
                uploadBoxes.forEach(box => {
                    const input = box.querySelector('input[type="file"]');
                    const preview = box.querySelector('.photo-preview');
                    const removeBtn = box.querySelector('.remove-photo-btn');
                    
                    // Click box to trigger file input
                    box.addEventListener('click', function(e) {
                        if (!e.target.classList.contains('remove-photo-btn') && !e.target.closest('.remove-photo-btn')) {
                            input.click();
                        }
                    });
                    
                    // Handle file selection
                    input.addEventListener('change', function(e) {
                        const file = e.target.files[0];
                        if (file && file.type.startsWith('image/')) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                preview.src = e.target.result;
                                box.classList.add('has-image');
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                    
                    // Remove photo
                    removeBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        input.value = '';
                        preview.src = '';
                        box.classList.remove('has-image');
                    });
                });
            }
            
            // Initialize photo uploads
            setupPhotoUpload(document.getElementById('addProductPhotos'));
            setupPhotoUpload(document.getElementById('editProductPhotos'));
            
            // Get photos from container
            function getPhotosFromContainer(container) {
                const photos = [];
                const uploadBoxes = container.querySelectorAll('.photo-upload-box');
                
                uploadBoxes.forEach(box => {
                    const preview = box.querySelector('.photo-preview');
                    if (box.classList.contains('has-image') && preview.src) {
                        photos.push(preview.src);
                    }
                });
                
                return photos;
            }
            
            // Set photos in container
            function setPhotosInContainer(container, photos) {
                const uploadBoxes = container.querySelectorAll('.photo-upload-box');
                
                uploadBoxes.forEach((box, index) => {
                    const preview = box.querySelector('.photo-preview');
                    const input = box.querySelector('input[type="file"]');
                    
                    if (photos[index]) {
                        preview.src = photos[index];
                        box.classList.add('has-image');
                    } else {
                        preview.src = '';
                        input.value = '';
                        box.classList.remove('has-image');
                    }
                });
            }
            
            // Clear photos in container
            function clearPhotosInContainer(container) {
                const uploadBoxes = container.querySelectorAll('.photo-upload-box');
                
                uploadBoxes.forEach(box => {
                    const preview = box.querySelector('.photo-preview');
                    const input = box.querySelector('input[type="file"]');
                    
                    preview.src = '';
                    input.value = '';
                    box.classList.remove('has-image');
                });
            }
            
            // Create photo display for table
            function createPhotoDisplay(photos) {
                const container = document.createElement('div');
                container.className = 'product-photos';
                
                if (photos && photos.length > 0) {
                    photos.forEach(photo => {
                        const img = document.createElement('img');
                        img.src = photo;
                        img.className = 'product-photo-thumb';
                        img.alt = 'Product Photo';
                        img.addEventListener('click', function(e) {
                            e.stopPropagation();
                            photoViewerImage.src = photo;
                            photoViewerModal.style.display = 'block';
                        });
                        container.appendChild(img);
                    });
                } else {
                    const noPhotos = document.createElement('span');
                    noPhotos.className = 'no-photos-text';
                    noPhotos.textContent = 'No photos';
                    container.appendChild(noPhotos);
                }
                
                return container;
            }
            
            // Photo viewer close
            photoViewerClose.addEventListener('click', function() {
                photoViewerModal.style.display = 'none';
            });
            
            photoViewerModal.addEventListener('click', function(e) {
                if (e.target === photoViewerModal) {
                    photoViewerModal.style.display = 'none';
                }
            });
            
            // Subcategories data
            const subcategories = {
                'dog': [
                    'Dry Dog Food', 'Wet Dog Food', 'Dog Treats', 'Dog Supplements',
                    'Dog Grooming', 'Dog Bowls', 'Dog Clothing', 'Dog Toys',
                    'Dog Crates', 'Dog Leads'
                ],
                'cat': [
                    'Dry Cat Food', 'Wet Cat Food', 'Cat Treats', 'Cat Toys',
                    'Cat Beds', 'Cat Litter', 'Cat Grooming', 'Cat Health',
                    'Cat Scratchers', 'Cat Accessories'
                ],
                'small-pet': [
                    'Small Pet Cages', 'Rabbit', 'Fencing for Small Pets',
                    'Small Pet Food', 'Cage Accessories', 'Snacks and Supplements',
                    'Hay and Straw', 'Small Pet Toys', 'Care and Grooming',
                    'Small Pet Special Offers'
                ],
                'feathered': [
                    'Bird Foods', 'Bird Cages', 'Bird Cage Accessories',
                    'Bird Snacks', 'Bird Toys', 'Bird Health',
                    'Bird Cage Bedding', 'Wild Birds', 'Feeding Supplies',
                    'Special Offers'
                ],
                'aquatic': [
                    'Aquarium Sand', 'Fish Tanks', 'Aquarium Filters',
                    'Fish Food', 'Aquarium Decorations', 'Aquarium Lighting',
                    'Fish Health', 'Aquarium Maintenance'
                ]
            };

            const categoryDisplayNames = {
                'dog': 'Dog',
                'cat': 'Cat',
                'small-pet': 'Small Pet',
                'feathered': 'Feathered',
                'aquatic': 'Aquatic'
            };
            
            // Subcategory functions
            function populateAddProductSubcategories(category) {
                newProductSubCategoryInput.innerHTML = '<option value="">Select Sub-Category</option>';
                
                const options = subcategories[category];
                if (options) {
                    options.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option;
                        optionElement.textContent = option;
                        newProductSubCategoryInput.appendChild(optionElement);
                    });
                }
            }
            
            function populateSubcategoryDropdown(category, currentSubCategory = '') {
                productSubCategoryInput.innerHTML = '';
                
                const options = subcategories[category];
                if (options) {
                    options.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option;
                        optionElement.textContent = option;
                        if (option === currentSubCategory) {
                            optionElement.selected = true;
                        }
                        productSubCategoryInput.appendChild(optionElement);
                    });
                }
            }
       
            function updateSubcategories(category) {
                subcategoryFilter.innerHTML = '';
                
                if (category === 'all') {
                    subcategoryFilter.style.display = 'none';
                    return;
                }
                
                const defaultOption = document.createElement('option');
                defaultOption.value = 'all';
                defaultOption.textContent = 'All Sub-Categories';
                defaultOption.selected = true;
                subcategoryFilter.appendChild(defaultOption);
                
                const options = subcategories[category];
                if (options) {
                    options.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option;
                        optionElement.textContent = option;
                        subcategoryFilter.appendChild(optionElement);
                    });
                    subcategoryFilter.style.display = 'block';
                } else {
                    subcategoryFilter.style.display = 'none';
                }
            }
            
            function filterProducts() {
                const selectedCategory = categoryFilter.value;
                const selectedSubcategory = subcategoryFilter.value;
                
                const rows = productsTableBody.querySelectorAll('tr');
                
                rows.forEach(row => {
                    const rowCategory = row.getAttribute('data-category');
                    const rowSubcategory = row.getAttribute('data-subcategory');
                    
                    let showRow = true;
                    
                    if (selectedCategory !== 'all' && rowCategory !== selectedCategory) {
                        showRow = false;
                    }
                    
                    if (selectedSubcategory !== 'all' && selectedSubcategory !== '' && rowSubcategory !== selectedSubcategory) {
                        showRow = false;
                    }
                    
                    if (showRow) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            }
            
            subcategoryFilter.style.display = 'none';
            
            categoryFilter.addEventListener('change', function() {
                updateSubcategories(this.value);
                filterProducts();
            });

            subcategoryFilter.addEventListener('change', function() {
                filterProducts();
            });

            newProductCategoryInput.addEventListener('change', function() {
                populateAddProductSubcategories(this.value);
            });
            
            // Add Product Button
            addProductBtn.addEventListener('click', function() {
                productIdCounter++;
                newProductIdInput.value = productIdCounter.toString().padStart(4, '0');
                
                newProductNameInput.value = '';
                newProductCategoryInput.value = '';
                newProductSubCategoryInput.innerHTML = '<option value="">Select Sub-Category</option>';
                newProductStocksInput.value = '0';
                newProductPriceInput.value = '';
                clearPhotosInContainer(document.getElementById('addProductPhotos'));
                
                addProductModal.style.display = 'block';
            });
            
            // Action dropdown management
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.action-dropdown')) {
                    document.querySelectorAll('.action-menu').forEach(menu => {
                        menu.classList.remove('show');
                    });
                }
                
                if (e.target.closest('.action-btn')) {
                    const actionBtn = e.target.closest('.action-btn');
                    const menu = actionBtn.nextElementSibling;
                    
                    document.querySelectorAll('.action-menu').forEach(m => {
                        if (m !== menu) {
                            m.classList.remove('show');
                        }
                    });
                    
                    const rect = actionBtn.getBoundingClientRect();
                    menu.style.position = 'fixed';
                    menu.style.left = (rect.left - 180) + 'px';
                    menu.style.top = (rect.bottom + 5) + 'px';
                    
                    menu.classList.toggle('show');
                }
            });
            
            // Setup action items for existing rows
            function setupActionItems(row) {
                const actionItems = row.querySelectorAll('.action-item');
                
                actionItems.forEach(item => {
                    const action = item.getAttribute('data-action');
                    
                    item.addEventListener('click', function() {
                        const currentRow = this.closest('tr');
                        const rowIndex = Array.from(currentRow.parentNode.children).indexOf(currentRow);
                        
                        if (action === 'edit-name') {
                            const currentProductName = currentRow.cells[1].textContent;
                            productNameInput.value = currentProductName;
                            productNameInput.dataset.rowIndex = rowIndex;
                            editProductNameModal.style.display = 'block';
                        } else if (action === 'edit-category') {
                            const currentCategory = currentRow.getAttribute('data-category');
                            productCategoryInput.value = currentCategory;
                            productCategoryInput.dataset.rowIndex = rowIndex;
                            editCategoryModal.style.display = 'block';
                        } else if (action === 'edit-subcategory') {
                            const currentCategory = currentRow.getAttribute('data-category');
                            const currentSubCategory = currentRow.getAttribute('data-subcategory');
                            populateSubcategoryDropdown(currentCategory, currentSubCategory);
                            productSubCategoryInput.dataset.rowIndex = rowIndex;
                            editSubCategoryModal.style.display = 'block';
                        } else if (action === 'edit-photos') {
                            const photos = currentRow.dataset.photos ? JSON.parse(currentRow.dataset.photos) : [];
                            setPhotosInContainer(document.getElementById('editProductPhotos'), photos);
                            currentEditPhotoRowIndex = rowIndex;
                            editPhotosModal.style.display = 'block';
                        } else if (action === 'manage-stocks') {
                            const currentStocks = currentRow.cells[5].textContent;
                            productStocksInput.value = currentStocks;
                            productStocksInput.dataset.rowIndex = rowIndex;
                            manageStocksModal.style.display = 'block';
                        } else if (action === 'edit-price') {
                            const currentPrice = currentRow.cells[6].textContent;
                            const numericPrice = currentPrice.replace('₱', '').replace(/,/g, '');
                            productPriceInput.value = numericPrice;
                            productPriceInput.dataset.rowIndex = rowIndex;
                            editProductPriceModal.style.display = 'block';
                        } else if (action === 'delete') {
                            const productName = currentRow.cells[1].textContent;
                            deleteProductNameSpan.textContent = productName;
                            currentDeleteRowIndex = rowIndex;
                            deleteConfirmationModal.style.display = 'block';
                        }
                        
                        this.closest('.action-menu').classList.remove('show');
                    });
                });
            }
            
            // Setup existing rows
            document.querySelectorAll('#products-table-body tr').forEach(row => {
                setupActionItems(row);
            });
            
            // Cancel buttons
            cancelBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    modal.style.display = 'none';
                    
                    if (modal.id === 'editPhotosModal') {
                        currentEditPhotoRowIndex = null;
                    } else if (modal.id === 'deleteConfirmationModal') {
                        currentDeleteRowIndex = null;
                    }
                });
            });
            
            // Add Product Submit
            addProductSubmitBtn.addEventListener('click', function() {
                const productId = newProductIdInput.value.trim();
                const productName = newProductNameInput.value.trim();
                const category = newProductCategoryInput.value;
                const subCategory = newProductSubCategoryInput.value;
                const stocks = newProductStocksInput.value.trim();
                const price = newProductPriceInput.value.trim();
                const photos = getPhotosFromContainer(document.getElementById('addProductPhotos'));
                
                // Validation
                if (!productId) {
                    showNotification('error', 'Error', 'Please enter a product ID');
                    return;
                }
                
                if (!productName) {
                    showNotification('error', 'Error', 'Please enter a product name');
                    return;
                }
                
                if (!category) {
                    showNotification('error', 'Error', 'Please select a category');
                    return;
                }
                
                if (!subCategory) {
                    showNotification('error', 'Error', 'Please select a sub-category');
                    return;
                }
                
                if (stocks === '' || isNaN(stocks) || parseInt(stocks) < 0) {
                    showNotification('error', 'Error', 'Please enter a valid stock quantity');
                    return;
                }
                
                if (price === '' || isNaN(price) || parseFloat(price) < 0) {
                    showNotification('error', 'Error', 'Please enter a valid price');
                    return;
                }
                
                const formattedPrice = '₱' + parseFloat(price).toLocaleString('en-PH', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
                
                // Create new row
                const newRow = document.createElement('tr');
                newRow.setAttribute('data-category', category);
                newRow.setAttribute('data-subcategory', subCategory);
                newRow.dataset.photos = JSON.stringify(photos);
                
                const photoCell = document.createElement('td');
                photoCell.appendChild(createPhotoDisplay(photos));
                
                newRow.innerHTML = `
                    <td><strong>${productId}</strong></td>
                    <td>${productName}</td>
                    <td>${categoryDisplayNames[category]}</td>
                    <td>${subCategory}</td>
                `;
                
                newRow.appendChild(photoCell);
                
                newRow.innerHTML += `
                    <td>${stocks}</td>
                    <td>${formattedPrice}</td>
                    <td>
                        <div class="action-dropdown">
                            <button class="action-btn">
                                <i class="fas fa-ellipsis-h"></i>
                            </button>
                            <div class="action-menu">
                                <div class="action-item" data-action="edit-name">Edit Product Name</div>
                                <div class="action-item" data-action="edit-category">Edit Category</div>
                                <div class="action-item" data-action="edit-subcategory">Edit Sub-Category</div>
                                <div class="action-item" data-action="edit-photos">Edit Photos</div>
                                <div class="action-item" data-action="manage-stocks">Manage Stocks</div>
                                <div class="action-item" data-action="edit-price">Edit Product Price</div>
                                <div class="action-item delete" data-action="delete">Delete</div>
                            </div>
                        </div>
                    </td>
                `;
                
                setupActionItems(newRow);
                productsTableBody.appendChild(newRow);
                addProductModal.style.display = 'none';
                showNotification('success', 'Success', 'Product added successfully');
            });
            
            // Update buttons
            updateBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    
                    if (modal.id === 'editPhotosModal') {
                        if (currentEditPhotoRowIndex !== null) {
                            const row = productsTableBody.children[currentEditPhotoRowIndex];
                            const photos = getPhotosFromContainer(document.getElementById('editProductPhotos'));
                            
                            row.dataset.photos = JSON.stringify(photos);
                            const photoCell = row.cells[4];
                            photoCell.innerHTML = '';
                            photoCell.appendChild(createPhotoDisplay(photos));
                            
                            showNotification('success', 'Success', 'Product photos updated successfully');
                            currentEditPhotoRowIndex = null;
                        }
                    } else {
                        const rowIndex = this.parentNode.previousElementSibling.querySelector('input, select').dataset.rowIndex;
                        const row = productsTableBody.children[rowIndex];
                        
                        if (modal.id === 'editProductNameModal') {
                            const newName = productNameInput.value.trim();
                            if (!newName) {
                                showNotification('error', 'Error', 'Please enter a product name');
                                return;
                            }
                            row.cells[1].textContent = newName;
                            showNotification('success', 'Success', 'Product name updated successfully');
                        } else if (modal.id === 'editCategoryModal') {
                            const newCategory = productCategoryInput.value;
                            const currentSubCategory = row.getAttribute('data-subcategory');
                            const newCategoryDisplayName = categoryDisplayNames[newCategory];
                            
                            row.setAttribute('data-category', newCategory);
                            row.cells[2].textContent = newCategoryDisplayName;
                            
                            const subcategoryOptions = subcategories[newCategory];
                            if (!subcategoryOptions.includes(currentSubCategory)) {
                                row.setAttribute('data-subcategory', subcategoryOptions[0]);
                                row.cells[3].textContent = subcategoryOptions[0];
                            }
                            
                            showNotification('success', 'Success', 'Category updated successfully');
                        } else if (modal.id === 'editSubCategoryModal') {
                            const newSubCategory = productSubCategoryInput.value;
                            row.setAttribute('data-subcategory', newSubCategory);
                            row.cells[3].textContent = newSubCategory;
                            showNotification('success', 'Success', 'Sub-category updated successfully');
                        } else if (modal.id === 'manageStocksModal') {
                            const newStocks = productStocksInput.value.trim();
                            if (newStocks === '' || isNaN(newStocks) || parseInt(newStocks) < 0) {
                                showNotification('error', 'Error', 'Please enter a valid stock quantity');
                                return;
                            }
                            row.cells[5].textContent = newStocks;
                            showNotification('success', 'Success', 'Stock quantity updated successfully');
                        } else if (modal.id === 'editProductPriceModal') {
                            const newPrice = productPriceInput.value.trim();
                            if (newPrice === '' || isNaN(newPrice) || parseFloat(newPrice) < 0) {
                                showNotification('error', 'Error', 'Please enter a valid price');
                                return;
                            }
                            const formattedPrice = '₱' + parseFloat(newPrice).toLocaleString('en-PH', {
                                minimumFractionDigits: 2,
                                maximumFractionDigits: 2
                            });
                            row.cells[6].textContent = formattedPrice;
                            showNotification('success', 'Success', 'Product price updated successfully');
                        }
                    }
                    
                    modal.style.display = 'none';
                });
            });
            
            // Delete button
            deleteBtn.addEventListener('click', function() {
                if (currentDeleteRowIndex !== null) {
                    const row = productsTableBody.children[currentDeleteRowIndex];
                    const productName = row.cells[1].textContent;
                    
                    row.remove();
                    deleteConfirmationModal.style.display = 'none';
                    currentDeleteRowIndex = null;
                    
                    showNotification('success', 'Success', `Product "${productName}" has been deleted`);
                }
            });
            
            // Close modals on outside click
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>